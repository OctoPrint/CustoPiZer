set -x
set -e

export LC_ALL=C


source /common.sh
install_cleanup_trap

if [ "$LEADER" == "1" ]; then

    curl -sL https://install.raspap.com | bash -s -- --yes --openvpn 0 --adblock 0

    # change port of webserver to not conflict with pioreactor.local
    sed -i "s/server.port                 = 80/server.port                 = 8080/" /etc/lighttpd/lighttpd.conf

    # change ssid and password
    sed -i "s/ssid=raspi-webgui/ssid=pioreactor/" /etc/hostapd/hostapd.conf
    sed -i "s/wpa_passphrase=ChangeMe/wpa_passphrase=raspberry/" /etc/hostapd/hostapd.conf

    # turn off by default. It's turned on by conditionally_start_raspap.sh, which is called by a service on boot.
    # TODO: hostapg, php still have services that start on boot.
    sudo systemctl disable raspapd.service

fi