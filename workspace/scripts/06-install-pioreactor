set -x
set -e

export LC_ALL=C


source /common.sh
install_cleanup_trap

PIO_DIR=/home/pi/.pioreactor
SOURCE_DIR=/home/pi/pioreactor



sudo -u pi mkdir -p $PIO_DIR
sudo -u pi mkdir -p $PIO_DIR/storage
sudo -u pi mkdir -p $PIO_DIR/plugins

cd /home/pi/pioreactor

if [ -n "$LEADER" ]; then
    sudo pip3 install -r $SOURCE_DIR/requirements/requirements_leader.txt
    sudo -u pi cp /files/config.example.ini $PIO_DIR/config.ini
fi



if [ -n "$WORKER" ]; then
    sudo apt-get install -y python3-numpy

    sudo pip3 install -r $SOURCE_DIR/requirements/requirements_worker.txt
    sudo -u pi touch $PIO_DIR/unit_config.ini
fi

sudo python3 setup.py install
