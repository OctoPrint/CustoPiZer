[Unit]
Description=Runs firstboot.sh on the first boot of the Raspberry Pi. If successful, it will modify itself to not run again.
Before=rc-local.service
After=network.target
ConditionFileNotEmpty=/boot/firstboot.sh

[Service]
ExecStart=/boot/firstboot.sh
ExecStartPost=/bin/mv /boot/firstboot.sh /boot/firstboot.sh.done
ExecStartPost=pio append_to_log -m "%n successful"
ExecStopPost=pio append_to_log -m "%n failed"
Type=oneshot
RemainAfterExit=no

[Install]
WantedBy=multi-user.target